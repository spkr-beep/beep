Installing beep
===============

This document describes how to install `beep` from sources and how to
set up the system afterwards.

If you are using `beep` as shipped in a binary distribution package,
that package should have done most of those steps for you.  The one
notable exception should be the step adding users to the `beep` group.


Build requirements
==================

  * autoconf, automake, make
  * clang or gcc
  * Linux kernel headers

Running the tests with "make check" has more requirement like `bash`
or `tput` which are not tested for (at this time).


Compile and Install
===================

The basic way to build and install beep is

```
[user@host beep]$ autoreconf -vif
[user@host beep]$ ./configure
[user@host beep]$ make
[user@host beep]$ make install
```

The buildsystem will use whatever value `CC` is as a compiler, and use
a few tools like `PANDOC` for building html from markdown. You can set
these to your desired values, including `PANDOC=false` to disable
building and installing html files.

For installing into a chroot environment, the use
`DESTDIR=/path/to/chroot` with the `install` target.

For a non-global installation, you can call `configure` with something
like `--prefix=$HOME/.local`.

If you need to run `make install` as another user to have the required
permission to install file to special locations, we strongly recommend
running `make` before to avoid running any build command as the
priviledged other user.

So a system wide install into `/usr/local` would be best achieved with

```
[user@host beep]$ ./configure
[user@host beep]$ make
[user@host beep]$ sudo make
```

For more details on what can be set at configure time, run
`./configure --help`.

Some more compilation related variables mostly useful for distribution
packagers are documented in [`PACKAGING.md`](PACKAGING.md).


System configuration
====================

  * The Linux kernel driver `pcspkr` must be loaded to provide
    access to the PC speaker via the evdev and console APIs.

  * To have the system load the `pcspkr` kernel module by default
    during each system boot, add a line

        alias platform:pcspkr pcspkr

    to a modprobe config file, like
    e.g. `/etc/modprobe.d/pcspkr-beep.conf`.

  * To load the `pcspkr` kernel module right now without needing to
    boot, run

        modprobe pcspkr

    To unload the `pcspkr` driver again, run

        modprobe -r pcspkr

  * Set up the udev rules which set the device special file
    permissions for non-root users according to
    [`PERMISSIONS.md`](PERMISSIONS.md).

    You can test whether the permission setup work by unloading and
    then loading the `pcspkr` kernel module, as loading the module
    will cause all the udev rules to run.

  * On some systems with integrated speakers like e.g. laptops from
    the IBM/Lenovo Thinkpad series, there is no separate physical
    speaker for the PC speaker.

	Instead, the square wave sound generated by the PC speaker goes to
    the integrated speakers through a mixer chip, where it is mixed
    with PCM sound, CD drive audio, line in, microphone in, and other
    sources.

	On these systems, you might need to configure the mixer to make
    the PC speaker audible through the laptop speakers, e.g.

	  * Start alsamixer.
	  * Find the correct card (switch with the `F6` key).
	  * Maybe enable loopback.
	  * Unmute the appropriate PC speaker source (`m` key) and turn up
        its volume.
	  * Weirdly, a microphone volume below 0% apparently can also
        silence the PC speaker beeps.

    Some experimentation might be required.

    Of course, these mixer settings must be saved before the next
    system reboot so that the reboot can restore the mixer
    settings. Some systems save the mixer settings as part of their
    shutdown procedure, others may need you to save them explicitly.
